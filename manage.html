<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>童行英语后台管理系统</title>
    <style>
        body {
            font-family: Arial, sans-serif;
            display: flex;
            flex-direction: column;
            align-items: center;
            min-height: 100vh;
            margin: 0;
            background-color: #f0f8ff;
            padding: 20px;
        }
        
        .header {
            text-align: center;
            margin-bottom: 20px;
            width: 100%;
        }
        
        .header h1 {
            color: #2c6e49;
            margin-bottom: 10px;
        }
        
        .admin-info {
            font-size: 18px;
            font-weight: bold;
            color: #2c6e49;
            margin-bottom: 10px;
        }
        
        .container {
            display: flex;
            flex-direction: column;
            width: 90%;
            max-width: 1200px;
            background-color: white;
            border-radius: 10px;
            padding: 20px;
            box-shadow: 0 2px 10px rgba(0,0,0,0.1);
        }
        
        .controls {
            display: flex;
            flex-wrap: wrap;
            gap: 15px;
            margin-bottom: 20px;
            padding: 15px;
            background-color: #f5f5f5;
            border-radius: 8px;
        }
        
        .control-group {
            display: flex;
            flex-direction: column;
            gap: 8px;
        }
        
        .control-group label {
            font-weight: bold;
            font-size: 14px;
        }
        
        select, input, button {
            padding: 8px 12px;
            border: 1px solid #ddd;
            border-radius: 4px;
            font-size: 14px;
            min-width: 150px;
        }
        
        button {
            background-color: #4CAF50;
            color: white;
            border: none;
            cursor: pointer;
            transition: background-color 0.3s;
            min-width: auto;
        }
        
        button:hover {
            background-color: #45a049;
        }
        
        .words-table-container {
            margin-top: 20px;
            width: 100%;
            overflow-x: auto;
        }
        
        .words-table {
            width: 100%;
            border-collapse: collapse;
        }
        
        .words-table th,
        .words-table td {
            border: 1px solid #ddd;
            padding: 12px;
            text-align: center;
        }
        
        .words-table th {
            background-color: #4CAF50;
            color: white;
        }
        
        .words-table tr:nth-child(even) {
            background-color: #f2f2f2;
        }
        
        .words-table tr:hover {
            background-color: #ddd;
        }
        
        .actions {
            display: flex;
            gap: 5px;
            justify-content: center;
        }
        
        .edit-btn {
            background-color: #2196F3;
        }
        
        .delete-btn {
            background-color: #f44336;
        }
        
        .add-word-form {
            margin-top: 20px;
            padding: 15px;
            background-color: #f5f5f5;
            border-radius: 8px;
            display: flex;
            flex-wrap: wrap;
            gap: 15px;
            align-items: flex-end;
        }
        
        .modal {
            display: none;
            position: fixed;
            z-index: 1000;
            left: 0;
            top: 0;
            width: 100%;
            height: 100%;
            background-color: rgba(0,0,0,0.5);
        }
        
        .modal-content {
            background-color: white;
            margin: 10% auto;
            padding: 20px;
            border-radius: 10px;
            width: 60%;
            max-width: 500px;
            box-shadow: 0 5px 15px rgba(0,0,0,0.3);
        }
        
        .close {
            color: #aaa;
            float: right;
            font-size: 28px;
            font-weight: bold;
            cursor: pointer;
        }
        
        .close:hover {
            color: #000;
        }
        
        .modal-form {
            display: flex;
            flex-direction: column;
            gap: 15px;
        }
        
        .modal-form-group {
            display: flex;
            flex-direction: column;
            gap: 5px;
        }
        
        .modal-form-group label {
            font-weight: bold;
            font-size: 14px;
        }
        
        .modal-buttons {
            display: flex;
            justify-content: flex-end;
            gap: 10px;
            margin-top: 15px;
        }
        
        .save-btn {
            background-color: #4CAF50;
            color: white;
            border: none;
            padding: 8px 15px;
            border-radius: 4px;
            cursor: pointer;
        }
        
        .cancel-btn {
            background-color: #ccc;
            color: black;
            border: none;
            padding: 8px 15px;
            border-radius: 4px;
            cursor: pointer;
        }
        
        .notification {
            position: fixed;
            top: 20px;
            right: 20px;
            padding: 15px 20px;
            border-radius: 5px;
            color: white;
            font-weight: bold;
            transform: translateX(150%);
            transition: transform 0.5s ease;
            z-index: 10000;
        }
        
        .notification.success {
            background-color: #4CAF50;
        }
        
        .notification.error {
            background-color: #f44336;
        }
        
        .notification.show {
            transform: translateX(0);
        }
        
        .tab-container {
            display: flex;
            margin-bottom: 20px;
        }
        
        .tab {
            padding: 10px 20px;
            background-color: #ddd;
            cursor: pointer;
            border-top-left-radius: 5px;
            border-top-right-radius: 5px;
            margin-right: 2px;
        }
        
        .tab.active {
            background-color: #4CAF50;
            color: white;
        }
        
        .tab-content {
            display: none;
        }
        
        .tab-content.active {
            display: block;
        }
        
        .footer {
            margin-top: 30px;
            color: #666;
            text-align: center;
        }
    </style>
</head>
<body>
    <div class="header">
        <h1>童行英语后台管理系统</h1>
        <div class="admin-info" id="adminInfo">未登录</div>
    </div>
    
    <div class="container">
        <div class="tab-container">
            <div class="tab active" data-tab="wordrecite">单词默写训练</div>
            <div class="tab" data-tab="wordrev">阅读类单词快训</div>
        </div>
        
        <div class="tab-content active" id="wordrecite-content">
            <div class="controls">
                <div class="control-group">
                    <label for="grade-select-wordrecite">年级选择</label>
                    <select id="grade-select-wordrecite">
                        <option value="" selected>-- 选择年级 --</option>
                        <option value="3A">三年级上</option>
                        <option value="3B">三年级下</option>
                        <option value="4A">四年级上</option>
                        <option value="4B">四年级下</option>
                        <option value="5B">五年级下</option>
                        <option value="6A">六年级上</option>
                        <option value="6B">六年级下</option>
                        <option value="7B">七年级下</option>
                        <option value="8B">八年级下</option>
                        <option value="9B">九年级下</option>
                    </select>
                </div>
                
                <div class="control-group">
                    <label for="unit-select-wordrecite">单元选择</label>
                    <select id="unit-select-wordrecite">
                        <option value="" selected>-- 请先选择年级 --</option>
                    </select>
                </div>
            </div>
            
            <div class="words-table-container">
                <table class="words-table" id="words-table-wordrecite">
                    <thead>
                        <tr>
                            <th>单词</th>
                            <th>中文释义</th>
                            <th>操作</th>
                        </tr>
                    </thead>
                    <tbody id="words-body-wordrecite">
                        <tr>
                            <td colspan="3">请选择年级和单元</td>
                        </tr>
                    </tbody>
                </table>
            </div>
            
            <div class="add-word-form">
                <div class="control-group">
                    <label for="new-word-wordrecite">新增单词</label>
                    <input type="text" id="new-word-wordrecite" placeholder="输入单词">
                </div>
                
                <div class="control-group">
                    <label for="new-meaning-wordrecite">中文释义</label>
                    <input type="text" id="new-meaning-wordrecite" placeholder="输入中文释义">
                </div>
                
                <div class="control-group">
                    <label>&nbsp;</label>
                    <button id="add-word-btn-wordrecite">添加单词</button>
                </div>
            </div>
        </div>
        
        <div class="tab-content" id="wordrev-content">
            <div class="controls">
                <div class="control-group">
                    <label for="grade-select-wordrev">年级选择</label>
                    <select id="grade-select-wordrev">
                        <option value="" selected>-- 选择年级 --</option>
                        <option value="3A">三年级上</option>
                        <option value="3B">三年级下</option>
                        <option value="4A">四年级上</option>
                        <option value="4B">四年级下</option>
                        <option value="5A">五年级上</option>
                        <option value="5B">五年级下</option>
                        <option value="6A">六年级上</option>
                        <option value="6B">六年级下</option>
                        <option value="7B">七年级下</option>
                        <option value="8B">八年级下</option>
                        <option value="9B">九年级下</option>
                        <option value="3Bbig">三年级下(PK)</option>
                        <option value="4Bbig">四年级下(PK)</option>
                        <option value="5Bbig">五年级下(PK)</option>
                        <option value="6Bbig">六年级下(PK)</option>
                        <option value="7Bbig">七年级下(PK)</option>
                        <option value="8Bbig">八年级下(PK)</option>
                        <option value="9Bbig">九年级下(PK)</option>
                    </select>
                </div>
                
                <div class="control-group">
                    <label for="unit-select-wordrev">单元选择</label>
                    <select id="unit-select-wordrev">
                        <option value="" selected>-- 请先选择年级 --</option>
                    </select>
                </div>
            </div>
            
            <div class="words-table-container">
                <table class="words-table" id="words-table-wordrev">
                    <thead>
                        <tr>
                            <th>单词</th>
                            <th>中文释义</th>
                            <th>操作</th>
                        </tr>
                    </thead>
                    <tbody id="words-body-wordrev">
                        <tr>
                            <td colspan="3">请选择年级和单元</td>
                        </tr>
                    </tbody>
                </table>
            </div>
            
            <div class="add-word-form">
                <div class="control-group">
                    <label for="new-word-wordrev">新增单词</label>
                    <input type="text" id="new-word-wordrev" placeholder="输入单词">
                </div>
                
                <div class="control-group">
                    <label for="new-meaning-wordrev">中文释义</label>
                    <input type="text" id="new-meaning-wordrev" placeholder="输入中文释义">
                </div>
                
                <div class="control-group">
                    <label>&nbsp;</label>
                    <button id="add-word-btn-wordrev">添加单词</button>
                </div>
            </div>
        </div>
    </div>
    
    <!-- 编辑单词的模态框 -->
    <div id="editModal" class="modal">
        <div class="modal-content">
            <span class="close">&times;</span>
            <h2>编辑单词</h2>
            <form class="modal-form" id="editForm">
                <input type="hidden" id="edit-type">
                <input type="hidden" id="edit-grade">
                <input type="hidden" id="edit-unit">
                <input type="hidden" id="edit-original-word">
                
                <div class="modal-form-group">
                    <label for="edit-word">单词</label>
                    <input type="text" id="edit-word" required>
                </div>
                
                <div class="modal-form-group">
                    <label for="edit-meaning">中文释义</label>
                    <input type="text" id="edit-meaning" required>
                </div>
                
                <div class="modal-buttons">
                    <button type="button" class="cancel-btn" id="cancelEdit">取消</button>
                    <button type="submit" class="save-btn">保存</button>
                </div>
            </form>
        </div>
    </div>
    
    <div class="notification" id="notification"></div>
    
    <div class="footer">
        <p>© 2025 童行英语学习系统 | 由童行宋老师开发</p>
    </div>
    
    <script>
        // 用户验证
        function checkAuthentication() {
            const loggedInUser = JSON.parse(localStorage.getItem('loggedInUser') || '{}');
            if (!loggedInUser.username || loggedInUser.role !== 'admin') {
                alert('请以管理员身份登录');
                window.location.href = './index.html';
                return false;
            }
            document.getElementById('adminInfo').textContent = `管理员: ${loggedInUser.username}`;
            return true;
        }
        
        // 数据存储和管理
        const DATA_KEYS = {
            wordrecite: {
                '3A': 'wordrecite_3A',
                '3B': 'wordrecite_3B',
                '4A': 'wordrecite_4A',
                '4B': 'wordrecite_4B',
                '5A': 'wordrecite_5A',
                '5B': 'wordrecite_5B',
                '6A': 'wordrecite_6A',
                '6B': 'wordrecite_6B'
            },
            wordrev: {
                '3A': 'wordrev_3A',
                '3B': 'wordrev_3B',
                '4A': 'wordrev_4A',
                '4B': 'wordrev_4B',
                '5A': 'wordrev_5A',
                '5B': 'wordrev_5B',
                '6A': 'wordrev_6A',
                '6B': 'wordrev_6B',
                '7B': 'wordrev_7B',
                '8B': 'wordrev_8B',
                '9B': 'wordrev_9B',
                '3Bbig': 'wordrev_3Bbig',
                '4Bbig': 'wordrev_4Bbig',
                '5Bbig': 'wordrev_5Bbig',
                '6Bbig': 'wordrev_6Bbig',
                '7Bbig': 'wordrev_7Bbig',
                '8Bbig': 'wordrev_8Bbig',
                '9Bbig': 'wordrev_9Bbig'
            }
        };
        
        // 加载单元列表
        function loadUnits(type, grade) {
            if (!grade) return [];
            
            const dataKey = DATA_KEYS[type][grade];
            const data = JSON.parse(localStorage.getItem(dataKey) || '{}');
            
            return Object.keys(data).map(unit => ({
                unit: unit,
                name: `Unit ${unit}`
            })).sort((a, b) => parseInt(a.unit) - parseInt(b.unit));
        }
        
        // 加载单词列表
        function loadWords(type, grade, unit) {
            if (!grade || !unit) return {};
            
            const dataKey = DATA_KEYS[type][grade];
            const data = JSON.parse(localStorage.getItem(dataKey) || '{}');
            
            return data[unit] || {};
        }
        
        // 保存单词数据
        function saveWords(type, grade, unit, words) {
            if (!grade || !unit) return false;
            
            const dataKey = DATA_KEYS[type][grade];
            const data = JSON.parse(localStorage.getItem(dataKey) || '{}');
            
            data[unit] = words;
            
            localStorage.setItem(dataKey, JSON.stringify(data));
            return true;
        }
        
        // 添加新单词
        function addWord(type, grade, unit, word, meaning) {
            if (!grade || !unit || !word || !meaning) return false;
            
            const words = loadWords(type, grade, unit);
            
            if (words[word]) {
                showNotification('该单词已存在', 'error');
                return false;
            }
            
            words[word] = meaning;
            
            return saveWords(type, grade, unit, words);
        }
        
        // 更新单词
        function updateWord(type, grade, unit, originalWord, newWord, newMeaning) {
            const words = loadWords(type, grade, unit);
            
            // 检查新单词是否与其他已有单词冲突（除了原单词外）
            if (newWord !== originalWord && words[newWord]) {
                showNotification('此单词已存在，请使用其他单词', 'error');
                return false;
            }
            
            // 删除原单词
            delete words[originalWord];
            
            // 添加新单词
            words[newWord] = newMeaning;
            
            return saveWords(type, grade, unit, words);
        }
        
        // 删除单词
        function deleteWord(type, grade, unit, word) {
            const words = loadWords(type, grade, unit);
            
            if (!words[word]) {
                showNotification('单词不存在', 'error');
                return false;
            }
            
            delete words[word];
            
            return saveWords(type, grade, unit, words);
        }
        
        // UI 相关函数
        function updateUnitSelect(type) {
            const gradeSelect = document.getElementById(`grade-select-${type}`);
            const unitSelect = document.getElementById(`unit-select-${type}`);
            const grade = gradeSelect.value;
            
            // 清空现有选项
            unitSelect.innerHTML = '<option value="" selected>-- 选择单元 --</option>';
            
            if (!grade) {
                unitSelect.innerHTML = '<option value="" selected>-- 请先选择年级 --</option>';
                return;
            }
            
            // 加载单元列表
            const units = loadUnits(type, grade);
            
            units.forEach(unit => {
                const option = document.createElement('option');
                option.value = unit.unit;
                option.textContent = unit.name;
                unitSelect.appendChild(option);
            });
            
            if (units.length === 0) {
                unitSelect.innerHTML = '<option value="" selected>-- 暂无单元 --</option>';
            }
        }
        
        function updateWordsTable(type) {
            const gradeSelect = document.getElementById(`grade-select-${type}`);
            const unitSelect = document.getElementById(`unit-select-${type}`);
            const wordsBody = document.getElementById(`words-body-${type}`);
            
            const grade = gradeSelect.value;
            const unit = unitSelect.value;
            
            // 清空表格
            wordsBody.innerHTML = '';
            
            if (!grade || !unit) {
                wordsBody.innerHTML = '<tr><td colspan="3">请选择年级和单元</td></tr>';
                return;
            }
            
            // 加载单词列表
            const words = loadWords(type, grade, unit);
            const wordsList = Object.entries(words);
            
            if (wordsList.length === 0) {
                wordsBody.innerHTML = '<tr><td colspan="3">该单元暂无单词</td></tr>';
                return;
            }
            
            // 填充表格
            wordsList.forEach(([word, meaning]) => {
                const tr = document.createElement('tr');
                
                const wordCell = document.createElement('td');
                wordCell.textContent = word;
                
                const meaningCell = document.createElement('td');
                meaningCell.textContent = meaning;
                
                const actionsCell = document.createElement('td');
                actionsCell.className = 'actions';
                
                const editBtn = document.createElement('button');
                editBtn.textContent = '编辑';
                editBtn.className = 'edit-btn';
                editBtn.addEventListener('click', () => openEditModal(type, grade, unit, word, meaning));
                
                const deleteBtn = document.createElement('button');
                deleteBtn.textContent = '删除';
                deleteBtn.className = 'delete-btn';
                deleteBtn.addEventListener('click', () => confirmDeleteWord(type, grade, unit, word));
                
                actionsCell.appendChild(editBtn);
                actionsCell.appendChild(deleteBtn);
                
                tr.appendChild(wordCell);
                tr.appendChild(meaningCell);
                tr.appendChild(actionsCell);
                
                wordsBody.appendChild(tr);
            });
        }
        
        // 打开编辑模态框
        function openEditModal(type, grade, unit, word, meaning) {
            const editType = document.getElementById('edit-type');
            const editGrade = document.getElementById('edit-grade');
            const editUnit = document.getElementById('edit-unit');
            const editOriginalWord = document.getElementById('edit-original-word');
            const editWord = document.getElementById('edit-word');
            const editMeaning = document.getElementById('edit-meaning');
            
            editType.value = type;
            editGrade.value = grade;
            editUnit.value = unit;
            editOriginalWord.value = word;
            editWord.value = word;
            editMeaning.value = meaning;
            
            document.getElementById('editModal').style.display = 'block';
        }
        
        // 保存编辑的单词
        function saveEditedWord(e) {
            e.preventDefault();
            
            const type = document.getElementById('edit-type').value;
            const grade = document.getElementById('edit-grade').value;
            const unit = document.getElementById('edit-unit').value;
            const originalWord = document.getElementById('edit-original-word').value;
            const newWord = document.getElementById('edit-word').value;
            const newMeaning = document.getElementById('edit-meaning').value;
            
            if (!newWord.trim() || !newMeaning.trim()) {
                showNotification('单词和释义不能为空', 'error');
                return;
            }
            
            const success = updateWord(type, grade, unit, originalWord, newWord, newMeaning);
            
            if (success) {
                document.getElementById('editModal').style.display = 'none';
                updateWordsTable(type);
                showNotification('单词更新成功', 'success');
            }
        }
        
        // 确认删除单词
        function confirmDeleteWord(type, grade, unit, word) {
            if (confirm(`确定要删除单词 "${word}" 吗？`)) {
                const success = deleteWord(type, grade, unit, word);
                
                if (success) {
                    updateWordsTable(type);
                    showNotification('单词删除成功', 'success');
                }
            }
        }
        
        // 添加新单词
        function addNewWord(type) {
            const gradeSelect = document.getElementById(`grade-select-${type}`);
            const unitSelect = document.getElementById(`unit-select-${type}`);
            const newWordInput = document.getElementById(`new-word-${type}`);
            const newMeaningInput = document.getElementById(`new-meaning-${type}`);
            
            const grade = gradeSelect.value;
            const unit = unitSelect.value;
            const word = newWordInput.value.trim();
            const meaning = newMeaningInput.value.trim();
            
            if (!grade || !unit) {
                showNotification('请选择年级和单元', 'error');
                return;
            }
            
            if (!word || !meaning) {
                showNotification('单词和释义不能为空', 'error');
                return;
            }
            
            const success = addWord(type, grade, unit, word, meaning);
            
            if (success) {
                newWordInput.value = '';
                newMeaningInput.value = '';
                updateWordsTable(type);
                showNotification('单词添加成功', 'success');
            }
        }
        
        // 切换标签页
        function switchTab(tabName) {
            document.querySelectorAll('.tab').forEach(tab => {
                if (tab.getAttribute('data-tab') === tabName) {
                    tab.classList.add('active');
                } else {
                    tab.classList.remove('active');
                }
            });
            
            document.querySelectorAll('.tab-content').forEach(content => {
                if (content.id === `${tabName}-content`) {
                    content.classList.add('active');
                } else {
                    content.classList.remove('active');
                }
            });
        }
        
        // 显示通知
        function showNotification(message, type) {
            const notification = document.getElementById('notification');
            notification.textContent = message;
            notification.className = `notification ${type}`;
            notification.classList.add('show');
            
            // 3秒后隐藏
            setTimeout(() => {
                notification.classList.remove('show');
            }, 3000);
        }
        
        // 初始化事件监听
        document.addEventListener('DOMContentLoaded', function() {
            // 检查用户认证
            if (!checkAuthentication()) return;
            
            // 年级选择变化时更新单元下拉菜单
            document.getElementById('grade-select-wordrecite').addEventListener('change', () => {
                updateUnitSelect('wordrecite');
                updateWordsTable('wordrecite');
            });
            
            document.getElementById('grade-select-wordrev').addEventListener('change', () => {
                updateUnitSelect('wordrev');
                updateWordsTable('wordrev');
            });
            
            // 单元选择变化时更新单词表格
            document.getElementById('unit-select-wordrecite').addEventListener('change', () => {
                updateWordsTable('wordrecite');
            });
            
            document.getElementById('unit-select-wordrev').addEventListener('change', () => {
                updateWordsTable('wordrev');
            });
            
            // 添加新单词
            document.getElementById('add-word-btn-wordrecite').addEventListener('click', () => {
                addNewWord('wordrecite');
            });
            
            document.getElementById('add-word-btn-wordrev').addEventListener('click', () => {
                addNewWord('wordrev');
            });
            
            // 编辑表单提交
            document.getElementById('editForm').addEventListener('submit', saveEditedWord);
            
            // 关闭模态框
            document.querySelectorAll('.close').forEach(close => {
                close.addEventListener('click', function() {
                    this.closest('.modal').style.display = 'none';
                });
            });
            
            // 取消编辑
            document.getElementById('cancelEdit').addEventListener('click', function() {
                document.getElementById('editModal').style.display = 'none';
            });
            
            // 标签切换
            document.querySelectorAll('.tab').forEach(tab => {
                tab.addEventListener('click', function() {
                    const tabName = this.getAttribute('data-tab');
                    switchTab(tabName);
                });
            });
            
            // 点击模态框外部关闭模态框
            window.addEventListener('click', function(event) {
                const modals = document.querySelectorAll('.modal');
                modals.forEach(modal => {
                    if (event.target === modal) {
                        modal.style.display = 'none';
                    }
                });
            });
            
            // 初始化界面
            updateUnitSelect('wordrecite');
            updateUnitSelect('wordrev');
        });
    </script>
</body>
</html>
