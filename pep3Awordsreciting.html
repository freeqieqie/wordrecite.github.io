<html><head><base href="./">
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>童行新三年级上单词默写训练</title>
<style>
body {
    font-family: Arial, sans-serif;
    display: flex;
    flex-direction: column;
    align-items: center;
    min-height: 100vh;
    margin: 0;
    background-color: #C7EDCC;
}
.container {
    text-align: center;
    background-color: #E8F6E9;
    padding: 2rem;
    border-radius: 10px;
    box-shadow: 0 0 10px rgba(0,0,0,0.1);
    margin-top: 2rem;
    width: 90%; /* 容器宽度占视窗90% */
    max-width: 600px; /* 最大宽度600px */
    margin-left: auto;
    margin-right: auto;
}
h1 {
    color: #333;
    margin-bottom: 1rem;
    font-size: 15px;
    font-weight: bold;
}
.unit-tabs {
    display: flex;
    justify-content: center; /* 改为居中对齐 */
    flex-wrap: wrap; /* 允许换行 */
    margin-bottom: 2rem;
    gap: 0.5rem; /* 添加间隙，确保按钮之间有统一的间距 */
    padding: 0 1rem; /* 添加左右内边距，避免按钮贴近屏幕边缘 */
}
.unit-tab {
    font-size: 1rem;
    margin: 0.5rem; /* 保持原有的间距 */
    padding: 0.5rem 1rem;
    background-color: #fafafa;
    border: none;
    border-radius: 5px;
    cursor: pointer;
    transition: background-color 0.3s;
    width: auto; /* 设置宽度为自动，适配文字长度 */
}
.unit-tab:hover, .unit-tab.active {
    background-color: #4CAF50;
    color: white;
}
.meaning {
    font-size: 1.5rem;
    margin-bottom: 1rem;
    color: #4a4a4a;
}
.spelling-area {
    display: flex;
    flex-direction: column;
    align-items: center;
    margin: 1rem 0;
    min-height: 120px;
    width: 100%;
}
.answer {
    display: flex;
    justify-content: center;
    align-items: center; /* Center letters vertically */
    min-height: 50px;
    width: 90%;
    max-width: 500px;
    margin-bottom: 1rem;
    background-color: #E8F6E9;  /* 修改为与容器相同的背景色 */
    border-radius: 5px;
    padding: 5px;
    flex-wrap: wrap;
    gap: 0.5rem;
}
.answer-line {
    width: 90%;
    max-width: 500px;
    height: 2px;
    background-color: #333;
    margin-bottom: 1rem;
}
.letters {
    display: flex; /* 改为flex布局 */
    flex-wrap: wrap; /* 允许换行 */
    justify-content: center; /* 水平居中 */
    align-items: center; /* 垂直居中 */
    gap: 0.5rem;
    width: 90%;
    max-width: 500px;
    padding: 10px;
    min-height: 100px;
    background-color: #E8F6E9;  /* 修改为与容器相同的背景色 */
    border-radius: 5px;
    margin: 0 auto; /* 容器自身居中 */
    position: relative; /* 添加相对定位 */
}
.letter {
    font-size: 1.5rem;
    margin: 0.25rem;
    width: 40px; /* Fixed width */
    height: 40px; /* Fixed height to match width */
    padding: 0; /* Remove padding */
    background-color: #e0e0e0;
    border: none;
    border-radius: 5px;
    cursor: grab; /* 修改光标样式，表示可拖拽 */
    transition: background-color 0.3s;
    display: flex; /* Use flexbox for centering */
    justify-content: center; /* Center horizontally */
    align-items: center; /* Center vertically */
    margin: 0;
    position: relative; /* 为拖拽添加定位 */
    z-index: 1; /* 确保字母在拖拽时位于上层 */
}
.letter:hover {
    background-color: #d0d0d0;
}
.letter-space {
    width: 40px;
    height: 40px;
    visibility: hidden;
    display: inline-block; /* 确保空白占位符显示为块级元素 */
    flex: 0 0 40px; /* 确保占位符不会改变大小 */
}
.letter.dragging {
    opacity: 0.5;
    cursor: grabbing;
    z-index: 10;
}
.insert-indicator {
    position: absolute;
    width: 2px;
    height: 40px;
    background-color: #4CAF50;
    z-index: 5;
}
.button-container {
    margin-top: 1rem;
}
.btn {
    font-size: 1rem;
    margin: 0.5rem;
    padding: 0.5rem 1rem;
    background-color: yellow;
    color: black;
    border: none;
    border-radius: 5px;
    cursor: pointer;
    transition: background-color 0.3s;
}
.btn:hover {
    opacity: 0.8;
}
.btn-check.correct {
    background-color: green;
    color: white;
}
.btn-check.incorrect {
    background-color: red;
    color: white;
}
.btn-next.correct {
    background-color: yellow;
    color: black;
}
.btn-next.incorrect {
    background-color: blue;
    color: white;
}
.progress {
    margin-top: 1rem;
    font-size: 1.2rem;
    color: #4a4a4a;
}
.footer {
    margin-top: 2rem;
    font-size: 0.8rem;
    color: #777;
    text-align: center;
}
</style>
</head>
<body>
<h1>童行新三年级上单词默写训练</h1>
<div class="button-container">
    <button class="btn" id="homeBtn">返回主页</button>
    <span id="timer" class="progress">00:00</span> <!-- 添加计时器 -->
</div>
<div class="unit-tabs">
    <button class="unit-tab active" data-unit="1">Unit 1</button>
    <button class="unit-tab" data-unit="2">Unit 2</button>
    <button class="unit-tab" data-unit="3">Unit 3</button>
    <button class="unit-tab" data-unit="4">Unit 4</button>
    <button class="unit-tab" data-unit="5">Unit 5</button>
    <button class="unit-tab" data-unit="6">Unit 6</button>
</div>
<div class="container">
    <div class="meaning" id="meaning"></div>
    <div class="spelling-area">
        <div class="answer" id="answer"></div>
        <div class="answer-line"></div>
    </div>
    <div class="letters" id="letters"></div>
    <div class="button-container">
        <button class="btn btn-check" id="checkBtn">检查</button>
        <button class="btn btn-next" id="nextBtn">恭喜完成</button>
    </div>
</div>
<div id="progress" class="progress"></div>
<footer class="footer">
    <p>本程序由童行宋老师使用AI完成制作</p>
</footer>
<script>
const units = {
    1: [
        { word: "nice", meaning: "美好的" },
        { word: "ear", meaning: "耳朵" },
        { word: "hand", meaning: "手" },
        { word: "eye", meaning: "眼睛" },
        { word: "mouth", meaning: "嘴" },
        { word: "arm", meaning: "胳膊" },
        { word: "can", meaning: "能够" },
        { word: "share", meaning: "分享" },
        { word: "smile", meaning: "微笑" },
        { word: "listen", meaning: "听" },
        { word: "help", meaning: "帮助" },
        { word: "say", meaning: "说" },
        { word: "and", meaning: "和" },
        { word: "goodbye", meaning: "再见" },
        { word: "toy", meaning: "玩具" },
        { word: "friend", meaning: "朋友" },
        { word: "good", meaning: "好的" }
    ],
    2: [
        { word: "mum", meaning: "妈妈" },
        { word: "mother", meaning: "母亲" },
        { word: "dad", meaning: "爸爸" },
        { word: "father", meaning: "父亲" },
        { word: "grandma", meaning: "奶奶/外婆" },
        { word: "grandmother", meaning: "祖母/外祖母" },
        { word: "grandpa", meaning: "爷爷/外公" },
        { word: "grandfather", meaning: "祖父/外祖父" },
        { word: "me", meaning: "我" },
        { word: "sister", meaning: "姐妹" },
        { word: "family", meaning: "家庭" },
        { word: "have", meaning: "有" },
        { word: "big", meaning: "大的" },
        { word: "cousin", meaning: "堂兄弟姐妹/表兄弟姐妹" },
        { word: "brother", meaning: "兄弟" },
        { word: "baby", meaning: "婴儿" },
        { word: "uncle", meaning: "叔叔/舅舅" },
        { word: "aunt", meaning: "阿姨/姑姑/婶婶" },
        { word: "some", meaning: "一些" },
        { word: "small", meaning: "小的" }
    ],
    3: [
        { word: "like", meaning: "喜欢" },
        { word: "dog", meaning: "狗" },
        { word: "pet", meaning: "宠物" },
        { word: "cat", meaning: "猫" },
        { word: "fish", meaning: "鱼" },
        { word: "bird", meaning: "鸟" },
        { word: "rabbit", meaning: "兔子" },
        { word: "go", meaning: "去" },
        { word: "zoo", meaning: "动物园" },
        { word: "fox", meaning: "狐狸" },
        { word: "Miss", meaning: "女士" },
        { word: "panda", meaning: "熊猫" },
        { word: "red panda", meaning: "小熊猫" },
        { word: "cute", meaning: "可爱的" },
        { word: "monkey", meaning: "猴子" },
        { word: "tiger", meaning: "老虎" },
        { word: "elephant", meaning: "大象" },
        { word: "lion", meaning: "狮子" },
        { word: "giraffe", meaning: "长颈鹿" },
        { word: "tall", meaning: "高的" },
        { word: "fast", meaning: "快的" }
    ],
    4: [
        { word: "apple", meaning: "苹果" },
        { word: "banana", meaning: "香蕉" },
        { word: "farm", meaning: "农场" },
        { word: "air", meaning: "空气" },
        { word: "orange", meaning: "橙子" },
        { word: "grape", meaning: "葡萄" },
        { word: "school", meaning: "学校" },
        { word: "garden", meaning: "花园" },
        { word: "need", meaning: "需要" },
        { word: "water", meaning: "水" },
        { word: "flower", meaning: "花" },
        { word: "grass", meaning: "草" },
        { word: "plant", meaning: "植物" },
        { word: "new", meaning: "新的" },
        { word: "tree", meaning: "树" },
        { word: "sun", meaning: "太阳" },
        { word: "give", meaning: "给" },
        { word: "us", meaning: "我们" },
        { word: "them", meaning: "他们" }
    ],
    5: [
        { word: "colour", meaning: "颜色" },
        { word: "orange", meaning: "橙色" },
        { word: "green", meaning: "绿色" },
        { word: "red", meaning: "红色" },
        { word: "blue", meaning: "蓝色" },
        { word: "make", meaning: "制作" },
        { word: "purple", meaning: "紫色" },
        { word: "brown", meaning: "棕色" },
        { word: "bear", meaning: "熊" },
        { word: "yellow", meaning: "黄色" },
        { word: "duck", meaning: "鸭子" },
        { word: "sea", meaning: "海" },
        { word: "pink", meaning: "粉色" },
        { word: "draw", meaning: "画" },
        { word: "white", meaning: "白色" },
        { word: "black", meaning: "黑色" }
    ],
    6: [
        { word: "old", meaning: "老的" },
        { word: "five", meaning: "五" },
        { word: "year", meaning: "年" },
        { word: "one", meaning: "一" },
        { word: "two", meaning: "二" },
        { word: "three", meaning: "三" },
        { word: "four", meaning: "四" },
        { word: "ten", meaning: "十" },
        { word: "six", meaning: "六" },
        { word: "seven", meaning: "七" },
        { word: "eight", meaning: "八" },
        { word: "nine", meaning: "九" },
        { word: "o'clock", meaning: "点钟" },
        { word: "cut", meaning: "切" },
        { word: "piece", meaning: "片" },
        { word: "eat", meaning: "吃" },
        { word: "cake", meaning: "蛋糕" }
    ]
};

let currentUnit = 1;
let currentWordIndex = 0;
let currentWord;

const lettersContainer = document.getElementById('letters');
const answerContainer = document.getElementById('answer');
const meaningElement = document.getElementById('meaning');
const checkBtn = document.getElementById('checkBtn');
const nextBtn = document.getElementById('nextBtn');
const unitTabs = document.querySelectorAll('.unit-tab');

function shuffleArray(array) {
    for (let i = array.length - 1; i > 0; i--) {
        const j = Math.floor(Math.random() * (i + 1));
        [array[i], array[j]] = [array[j], array[i]];
    }
    return array;
}

function displayWord() {
    currentWord = units[currentUnit][currentWordIndex];
    meaningElement.textContent = `${currentWord.meaning}`;
    const shuffledLetters = shuffleArray([...currentWord.word]);
    
    // 清空容器
    lettersContainer.innerHTML = '';
    answerContainer.innerHTML = '';
    
    // 计算每行可以放置的字母数量（根据容器宽度和字母宽度）
    const letterWidth = 40; // 字母宽度
    const letterMargin = 8; // 字母间距
    const containerWidth = lettersContainer.clientWidth;
    const lettersPerRow = Math.floor(containerWidth / (letterWidth + letterMargin));
    
    // 创建字母块
    shuffledLetters.forEach(letter => {
        const letterButton = document.createElement('button');
        letterButton.className = 'letter';
        letterButton.textContent = letter;
        letterButton.addEventListener('click', () => moveLetter(letterButton));
        
        // 添加拖拽功能
        letterButton.setAttribute('draggable', 'true');
        letterButton.addEventListener('dragstart', handleDragStart);
        letterButton.addEventListener('dragend', handleDragEnd);
        
        lettersContainer.appendChild(letterButton);
    });
    
    // 为答案区域添加放置区域事件
    answerContainer.addEventListener('dragover', handleDragOver);
    answerContainer.addEventListener('drop', handleDrop);
    
    // 为字母区域添加放置区域事件
    lettersContainer.addEventListener('dragover', handleDragOver);
    lettersContainer.addEventListener('drop', handleDrop);

    resetButtons();
    updateProgress();
    
    // 清除所有占位符和指示器
    document.querySelectorAll('.letter-space, .insert-indicator').forEach(space => {
        space.remove();
    });
    
    // 重置拖拽相关变量
    draggedElement = null;
    originalParent = null;
    originalNextSibling = null;
    placeholder = null;
}

// 拖拽相关函数
let draggedElement = null;
let originalParent = null;
let originalNextSibling = null;
let placeholder = null;

function handleDragStart(e) {
    draggedElement = this;
    originalParent = this.parentNode;
    originalNextSibling = this.nextSibling;
    
    // 创建占位符，保持原位置
    if (originalParent === lettersContainer) {
        placeholder = document.createElement('div');
        placeholder.className = 'letter-space';
        originalParent.insertBefore(placeholder, originalNextSibling);
    }
    
    this.classList.add('dragging');
    e.dataTransfer.effectAllowed = 'move';
    e.dataTransfer.setData('text/plain', this.textContent);
    
    // 延迟设置拖拽图像，避免闪烁
    setTimeout(() => {
        this.style.opacity = '0.5';
    }, 0);
    
    startTimer(); // 开始计时
}

function handleDragEnd(e) {
    this.classList.remove('dragging');
    this.style.opacity = '1';
    
    // 如果拖拽未成功完成（没有放置到有效区域），恢复原位置
    if (draggedElement && !draggedElement.parentNode) {
        if (originalParent === lettersContainer && placeholder) {
            originalParent.replaceChild(draggedElement, placeholder);
        } else {
            originalParent.insertBefore(draggedElement, originalNextSibling);
        }
    }
    
    draggedElement = null;
    originalParent = null;
    originalNextSibling = null;
    
    // 移除所有占位符
    document.querySelectorAll('.letter-space').forEach(space => {
        if (space === placeholder) {
            space.remove();
        }
    });
    placeholder = null;
}

function handleDragOver(e) {
    e.preventDefault();
    e.dataTransfer.dropEffect = 'move';
    
    // 获取当前拖动经过的元素
    const target = e.target;
    
    // 如果拖动经过的是字母块，并且在答案区域内
    if (target.classList.contains('letter') && target.parentNode === answerContainer) {
        // 计算鼠标位置
        const rect = target.getBoundingClientRect();
        const mouseX = e.clientX;
        const middleX = rect.left + rect.width / 2;
        
        // 移除所有临时指示器
        document.querySelectorAll('.insert-indicator').forEach(el => el.remove());
        
        // 创建插入指示器
        const indicator = document.createElement('div');
        indicator.className = 'insert-indicator';
        
        // 根据鼠标位置决定插入指示器的位置
        if (mouseX < middleX) {
            // 鼠标在字母块左侧
            indicator.style.left = `${rect.left - 2}px`;
            indicator.style.top = `${rect.top}px`;
            target.dataset.insertPosition = 'before';
        } else {
            // 鼠标在字母块右侧
            indicator.style.left = `${rect.right}px`;
            indicator.style.top = `${rect.top}px`;
            target.dataset.insertPosition = 'after';
        }
        
        // 添加指示器到文档
        document.body.appendChild(indicator);
    }
    
    return false;
}

function handleDrop(e) {
    e.preventDefault();
    
    if (!draggedElement) return;
    
    // 移除所有插入指示器
    document.querySelectorAll('.insert-indicator').forEach(el => el.remove());
    
    const target = e.target;
    
    // 如果放置在答案区域的字母块上
    if (target.classList.contains('letter') && target.parentNode === answerContainer) {
        // 根据之前确定的插入位置插入字母块
        const insertPosition = target.dataset.insertPosition || 'after';
        
        if (insertPosition === 'before') {
            answerContainer.insertBefore(draggedElement, target);
        } else {
            answerContainer.insertBefore(draggedElement, target.nextSibling);
        }
        
        // 更新事件监听器
        draggedElement.removeEventListener('click', () => moveLetter(draggedElement));
        draggedElement.addEventListener('click', () => returnLetter(draggedElement, placeholder));
        
        // 清除插入位置标记
        target.removeAttribute('data-insert-position');
    }
    // 如果放置在答案区域（但不是字母块上）
    else if (this === answerContainer) {
        // 从字母区域拖到答案区域
        answerContainer.appendChild(draggedElement);
        draggedElement.removeEventListener('click', () => moveLetter(draggedElement));
        draggedElement.addEventListener('click', () => returnLetter(draggedElement, placeholder));
    } else if (this === lettersContainer && draggedElement.parentNode === answerContainer) {
        // 从答案区域拖回字母区域
        if (placeholder && placeholder.parentNode === lettersContainer) {
            // 使用替换方法而不是移除后添加，这样可以保持布局
            lettersContainer.replaceChild(draggedElement, placeholder);
            placeholder = null;
        } else {
            // 如果没有原始占位符，查找一个空的letter-space来替换
            const emptySpaces = Array.from(lettersContainer.querySelectorAll('.letter-space'));
            if (emptySpaces.length > 0) {
                lettersContainer.replaceChild(draggedElement, emptySpaces[0]);
            } else {
                // 如果没有空位，直接添加到字母容器末尾
                lettersContainer.appendChild(draggedElement);
            }
        }
        
        draggedElement.removeEventListener('click', () => returnLetter(draggedElement, placeholder));
        draggedElement.addEventListener('click', () => moveLetter(draggedElement));
    }
    
    return false;
}

function updateProgress() {
    const progressElement = document.getElementById('progress');
    const totalWords = units[currentUnit].length;
    progressElement.textContent = `${currentWordIndex + 1}/${totalWords}`;
}

function moveLetter(letterButton) {
    // 创建占位符，保持原位置
    const placeholder = document.createElement('div');
    placeholder.className = 'letter-space';
    
    // 记录字母块的原始位置
    const originalIndex = Array.from(lettersContainer.children).indexOf(letterButton);
    
    // 插入占位符到字母块的位置
    lettersContainer.insertBefore(placeholder, letterButton);
    
    // 移动字母块到答案区域
    answerContainer.appendChild(letterButton);
    
    // 更新事件监听器
    letterButton.removeEventListener('click', () => moveLetter(letterButton));
    letterButton.addEventListener('click', () => returnLetter(letterButton, placeholder));
    
    startTimer(); // 开始计时
}

function returnLetter(letterButton, placeholder) {
    // 移除所有可能存在的临时指示器
    document.querySelectorAll('.insert-indicator').forEach(el => el.remove());
    
    // 如果有占位符，替换占位符；否则直接添加到字母容器
    if (placeholder && placeholder.parentNode === lettersContainer) {
        // 使用替换方法而不是移除后添加，这样可以保持布局
        lettersContainer.replaceChild(letterButton, placeholder);
    } else {
        // 如果没有占位符，查找一个空的letter-space来替换
        const emptySpaces = Array.from(lettersContainer.querySelectorAll('.letter-space'));
        if (emptySpaces.length > 0) {
            lettersContainer.replaceChild(letterButton, emptySpaces[0]);
        } else {
            // 如果没有空位，直接添加到字母容器末尾
            lettersContainer.appendChild(letterButton);
        }
    }
    
    // 重新绑定事件
    letterButton.removeEventListener('click', () => returnLetter(letterButton, placeholder));
    letterButton.addEventListener('click', () => moveLetter(letterButton));
}

function checkAnswer() {
    const userAnswer = Array.from(answerContainer.children)
        .filter(child => child.classList.contains('letter')) // 只考虑字母元素，排除可能的占位符
        .map(child => child.textContent)
        .join('');
        
    if (userAnswer === currentWord.word) {
        checkBtn.textContent = "正确";
        checkBtn.classList.add('correct');
        nextBtn.textContent = "下一个";
        nextBtn.classList.add('correct');
        nextBtn.classList.remove('incorrect');
        playAudio(currentWord.word);
        
        // 检查是否完成当前单元
        if (currentWordIndex === units[currentUnit].length - 1) {
            nextBtn.textContent = "恭喜完成"; // 修改按钮文本
            clearInterval(timerInterval); // 停止计时
        }
    } else {
        checkBtn.textContent = "错误";
        checkBtn.classList.add('incorrect');
        nextBtn.textContent = "请订正";
        nextBtn.classList.add('incorrect');
        nextBtn.classList.remove('correct');
        setTimeout(() => {
            checkBtn.textContent = "检查";
            checkBtn.classList.remove('incorrect');
        }, 2000);
    }
}

function nextWord() {
    if (checkBtn.textContent === "正确") {
        // 清除所有占位符和指示器
        document.querySelectorAll('.letter-space, .insert-indicator').forEach(space => {
            space.remove();
        });
        
        currentWordIndex = (currentWordIndex + 1) % units[currentUnit].length;
        displayWord();
        resetButtons();
        
        // 重置拖拽相关变量
        draggedElement = null;
        originalParent = null;
        originalNextSibling = null;
        placeholder = null;
    } else if (nextBtn.textContent === "恭喜完成") {
        // 不执行任何操作，直接返回
        return;
    }
}

function playAudio(word) {
    const audio = new Audio(`https://dict.youdao.com/dictvoice?audio=${word}&type=1`);
    audio.play().catch(error => console.error('Error playing audio:', error));
}

function changeUnit(unit) {
    resetTimer(); // 重置计时器
    
    // 清除所有占位符和指示器
    document.querySelectorAll('.letter-space, .insert-indicator').forEach(space => {
        space.remove();
    });
    
    currentUnit = unit;
    currentWordIndex = 0;
    displayWord();
    unitTabs.forEach(tab => tab.classList.remove('active'));
    document.querySelector(`.unit-tab[data-unit="${unit}"]`).classList.add('active');
    
    // 重置拖拽相关变量
    draggedElement = null;
    originalParent = null;
    originalNextSibling = null;
    placeholder = null;
    // 不再在这里调用 startTimer()
}

function resetButtons() {
    checkBtn.textContent = "检查";
    checkBtn.classList.remove('correct', 'incorrect');
    nextBtn.textContent = "下一个";
    nextBtn.classList.remove('correct', 'incorrect');
}

function resetTimer() {
    clearInterval(timerInterval); // 停止计时
    seconds = 0; // 重置计时器
    document.getElementById('timer').textContent = "00:00"; // 显示为零
    timerInterval = null; // 清空计时器变量
}

checkBtn.addEventListener('click', checkAnswer);
nextBtn.addEventListener('click', () => {
    if (nextBtn.textContent === "恭喜完成") {
        // 不执行任何操作，直接返回
        return;
    }
    nextWord(); // 仅在不是"恭喜完成"时调用 nextWord
});

unitTabs.forEach(tab => {
    tab.addEventListener('click', () => changeUnit(parseInt(tab.dataset.unit)));
});

displayWord();

let timerInterval;
let seconds = 0;

document.getElementById('homeBtn').addEventListener('click', () => {
    window.location.href = './index.html';  // 使用相对路径
});

function startTimer() {
    if (!timerInterval) {
        timerInterval = setInterval(() => {
            seconds++;
            const minutes = String(Math.floor(seconds / 60)).padStart(2, '0');
            const secs = String(seconds % 60).padStart(2, '0');
            document.getElementById('timer').textContent = `${minutes}:${secs}`;
        }, 1000);
    }
}
</script>
</body>
</html>