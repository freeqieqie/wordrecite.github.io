<html><head><base href="./">
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>童行六年级下单词默写训练</title>
    <style>
    body {
        font-family: Arial, sans-serif;
        display: flex;
        flex-direction: column;
        align-items: center;
        min-height: 100vh;
        margin: 0;
        background-color: #C7EDCC;
    }
    .container {
        text-align: center;
        background-color: #E8F6E9;
        padding: 2rem;
        border-radius: 10px;
        box-shadow: 0 0 10px rgba(0,0,0,0.1);
        margin-top: 2rem;
        width: 90%; /* 容器宽度占视窗90% */
        max-width: 600px; /* 最大宽度600px */
        margin-left: auto;
        margin-right: auto;
    }
    h1 {
        color: #333;
        margin-bottom: 1rem;
        font-size: 15px;
        font-weight: bold;
    }
    .unit-tabs {
    display: flex;
    justify-content: center; /* 改为居中对齐 */
    flex-wrap: wrap; /* 允许换行 */
    margin-bottom: 2rem;
    gap: 0.5rem; /* 添加间隙，确保按钮之间有统一的间距 */
    padding: 0 1rem; /* 添加左右内边距，避免按钮贴近屏幕边缘 */
}
    .unit-tab {
        font-size: 1rem;
        margin: 0.5rem; /* 保持原有的间距 */
        padding: 0.5rem 1rem;
        background-color: #fafafa;
        border: none;
        border-radius: 5px;
        cursor: pointer;
        transition: background-color 0.3s;
        width: auto; /* 设置宽度为自动，适配文字长度 */
    }
    .unit-tab:hover, .unit-tab.active {
        background-color: #4CAF50;
        color: white;
    }
    .meaning {
        font-size: 1.5rem;
        margin-bottom: 1rem;
        color: #4a4a4a;
    }
    .spelling-area {
        display: flex;
        flex-direction: column;
        align-items: center;
        margin: 1rem 0;
        min-height: 120px;
        width: 100%;
    }
    .answer {
        display: flex;
        justify-content: center;
        align-items: center; /* Center letters vertically */
        min-height: 50px;
        width: 90%;
        max-width: 500px;
        margin-bottom: 1rem;
        background-color: #E8F6E9;
        border-radius: 5px;
        padding: 5px;
        flex-wrap: wrap;
        gap: 0.5rem;
    }
    .answer-line {
        width: 90%;
        max-width: 500px;
        height: 2px;
        background-color: #333;
        margin-bottom: 1rem;
    }
    .letters {
        display: flex; /* 改为flex布局 */
        flex-wrap: wrap; /* 允许换行 */
        justify-content: center; /* 水平居中 */
        align-items: center; /* 垂直居中 */
        gap: 0.5rem;
        width: 90%;
        max-width: 500px;
        padding: 10px;
        min-height: 100px;
        background-color: #E8F6E9;
        border-radius: 5px;
        margin: 0 auto; /* 容器自身居中 */
        position: relative; /* 添加相对定位 */
    }
    .letter {
        font-size: 1.5rem;
        margin: 0.25rem;
        width: 40px; /* Fixed width */
        height: 40px; /* Fixed height to match width */
        padding: 0; /* Remove padding */
        background-color: #e0e0e0;
        border: none;
        border-radius: 5px;
        cursor: grab; /* 修改光标样式，表示可拖拽 */
        transition: background-color 0.3s;
        display: flex; /* Use flexbox for centering */
        justify-content: center; /* Center horizontally */
        align-items: center; /* Center vertically */
        margin: 0;
        position: relative; /* 为拖拽添加定位 */
        z-index: 1; /* 确保字母在拖拽时位于上层 */
    }
    .letter:hover {
        background-color: #d0d0d0;
    }
    .letter-space {
        width: 40px;
        height: 40px;
        visibility: hidden;
        display: inline-block; /* 确保空白占位符显示为块级元素 */
        flex: 0 0 40px; /* 确保占位符不会改变大小 */
    }
    .letter.dragging {
        opacity: 0.5;
        cursor: grabbing;
        z-index: 10;
    }
    .insert-indicator {
        position: absolute;
        width: 2px;
        height: 40px;
        background-color: #4CAF50;
        z-index: 5;
    }
    .button-container {
        margin-top: 1rem;
    }
    .btn {
        font-size: 1rem;
        margin: 0.5rem;
        padding: 0.5rem 1rem;
        background-color: yellow;
        color: black;
        border: none;
        border-radius: 5px;
        cursor: pointer;
        transition: background-color 0.3s;
    }
    .btn:hover {
        opacity: 0.8;
    }
    .btn-check.correct {
        background-color: green;
        color: white;
    }
    .btn-check.incorrect {
        background-color: red;
        color: white;
    }
    .btn-next.correct {
        background-color: yellow;
        color: black;
    }
    .btn-next.incorrect {
        background-color: blue;
        color: white;
    }
    .progress {
        margin-top: 1rem;
        font-size: 1.2rem;
        color: #4a4a4a;
    }
    .footer {
        margin-top: 2rem;
        font-size: 0.8rem;
        color: #777;
        text-align: center;
    }
    </style>
    </head>
    <body>
    <h1>童行六年级下单词默写训练</h1>
    <div class="button-container">
        <button class="btn" id="homeBtn">返回主页</button>
        <span id="timer" class="progress">00:00</span> <!-- 添加计时器 -->
    </div>
    <div class="unit-tabs">
        <button class="unit-tab active" data-unit="1">Unit 1</button>
        <button class="unit-tab" data-unit="2">Unit 2</button>
        <button class="unit-tab" data-unit="3">Unit 3</button>
        <button class="unit-tab" data-unit="4">Unit 4</button>

    </div>
    <div class="container">
        <div class="meaning" id="meaning"></div>
        <div class="spelling-area">
            <div class="answer" id="answer"></div>
            <div class="answer-line"></div>
        </div>
        <div class="letters" id="letters"></div>
        <div class="button-container">
            <button class="btn btn-check" id="checkBtn">检查</button>
            <button class="btn btn-next" id="nextBtn">恭喜完成</button>
        </div>
    </div>
    <div id="progress" class="progress"></div>
    <footer class="footer">
        <p>本程序由童行宋老师使用AI完成制作</p>
    </footer>
    <script>
    const units = {
        1: [
            { word: "younger", meaning: "更年轻的" },
            { word: "older", meaning: "更老的" },
            { word: "taller", meaning: "更高的" },
            { word: "shorter", meaning: "更短的" },
            { word: "longer", meaning: "更长的" },
            { word: "thinner", meaning: "更瘦的" },
            { word: "heavier", meaning: "更重的" },
            { word: "bigger", meaning: "更大的" },
            { word: "smaller", meaning: "更小的" },
            { word: "stronger", meaning: "更强壮的" },
            { word: "dinosaur", meaning: "恐龙" },
            { word: "hall", meaning: "大厅" },
            { word: "metre", meaning: "米" },
            { word: "meter", meaning: "米" },
            { word: "than", meaning: "比" },
            { word: "both", meaning: "两者都" },
            { word: "kilogram", meaning: "千克" },
            { word: "countryside", meaning: "乡村" },
            { word: "lower", meaning: "较低的" },
            { word: "shadow", meaning: "影子" },
            { word: "smarter", meaning: "更聪明的" },
            { word: "become", meaning: "变成" }

        ],
        2: [
            { word: "cleaned", meaning: "打扫了" },
            { word: "stayed", meaning: "呆在了" },
            { word: "washed", meaning: "洗了" },
            { word: "had", meaning: "有了" },
            { word: "had a cold", meaning: "感冒了" },
            { word: "slept", meaning: "睡觉了" },
            { word: "read", meaning: "读了" },
            { word: "saw", meaning: "看见了" },
            { word: "last", meaning: "最后一个" },
            { word: "yesterday", meaning: "昨天" },
            { word: "before", meaning: "在...之前" },
            { word: "drank", meaning: "喝了" },
            { word: "show", meaning: "展示" },
            { word: "magazine", meaning: "杂志" },
            { word: "better", meaning: "更好的" },
            { word: "faster", meaning: "更快地" },
            { word: "hotel", meaning: "酒店" },
            { word: "fixed", meaning: "修理好了" },
            { word: "broken", meaning: "坏掉了" },
            { word: "lamp", meaning: "台灯" },
            { word: "loud", meaning: "响亮" },
            { word: "enjoy", meaning: "享受" },
            { word: "stay", meaning: "停留" }
        ],
        3: [
            { word: "went", meaning: "去" },
            { word: "camp", meaning: "营地" },
            { word: "went camping", meaning: "去露营" },
            { word: "fish", meaning: "鱼" },
            { word: "went fishing", meaning: "去钓鱼" },
            { word: "rode", meaning: "骑" },
            { word: "hurt", meaning: "受伤" },
            { word: "ate", meaning: "吃" },
            { word: "took", meaning: "拿" },
            { word: "took pictures", meaning: "拍照" },
            { word: "bought", meaning: "买" },
            { word: "gift", meaning: "礼物" },
            { word: "fell", meaning: "跌倒" },
            { word: "off", meaning: "关闭" },
            { word: "Labour Day", meaning: "劳动节" },
            { word: "mule", meaning: "骡子" },
            { word: "Turpan", meaning: "吐鲁番" },
            { word: "could", meaning: "能够" },
            { word: "till", meaning: "直到" },
            { word: "beach", meaning: "海滩" },
            { word: "basket", meaning: "篮子" },
            { word: "part", meaning: "部分" },
            { word: "licked", meaning: "舔" },
            { word: "laughed", meaning: "笑" },
        ],
        4: [
            { word: "dining hall", meaning: "食堂" },
            { word: "grass", meaning: "草" },
            { word: "gym", meaning: "体育馆" },
            { word: "ago", meaning: "以前" },
            { word: "cycling", meaning: "骑自行车" },
            { word: "go cycling", meaning: "去骑自行车" },
            { word: "ice-skate", meaning: "溜冰" },
            { word: "badminton", meaning: "羽毛球" },
            { word: "star", meaning: "星星" },
            { word: "easy", meaning: "简单" },
            { word: "look up", meaning: "查阅" },
            { word: "Internet", meaning: "互联网" },
            { word: "different", meaning: "不同" },
            { word: "active", meaning: "活跃" },
            { word: "race", meaning: "比赛" },
            { word: "nothing", meaning: "什么也没有" },
            { word: "thought", meaning: "想" },
            { word: "felt", meaning: "感觉到" },
            { word: "cheetah", meaning: "猎豹" },
            { word: "trip", meaning: "旅行" },
            { word: "woke", meaning: "醒来" },
            { word: "dream", meaning: "梦" }
        ]
    };
    
    let currentUnit = 1;
    let currentWordIndex = 0;
    let currentWord;
    
    const lettersContainer = document.getElementById('letters');
    const answerContainer = document.getElementById('answer');
    const meaningElement = document.getElementById('meaning');
    const checkBtn = document.getElementById('checkBtn');
    const nextBtn = document.getElementById('nextBtn');
    const unitTabs = document.querySelectorAll('.unit-tab');
    
    function shuffleArray(array) {
        for (let i = array.length - 1; i > 0; i--) {
            const j = Math.floor(Math.random() * (i + 1));
            [array[i], array[j]] = [array[j], array[i]];
        }
        return array;
    }
    
    function displayWord() {
        currentWord = units[currentUnit][currentWordIndex];
        meaningElement.textContent = `${currentWord.meaning}`;
        const shuffledLetters = shuffleArray([...currentWord.word]);
        
        // 清空容器
        lettersContainer.innerHTML = '';
        answerContainer.innerHTML = '';
        
        // 计算每行可以放置的字母数量（根据容器宽度和字母宽度）
        const letterWidth = 40; // 字母宽度
        const letterMargin = 8; // 字母间距
        const containerWidth = lettersContainer.clientWidth;
        const lettersPerRow = Math.floor(containerWidth / (letterWidth + letterMargin));
        
        // 创建字母块
        shuffledLetters.forEach(letter => {
            const letterButton = document.createElement('button');
            letterButton.className = 'letter';
            letterButton.textContent = letter;
            letterButton.addEventListener('click', () => moveLetter(letterButton));
            
            // 添加拖拽功能
            letterButton.setAttribute('draggable', 'true');
            letterButton.addEventListener('dragstart', handleDragStart);
            letterButton.addEventListener('dragend', handleDragEnd);
            
            lettersContainer.appendChild(letterButton);
        });
        
        // 为答案区域添加放置区域事件
        answerContainer.addEventListener('dragover', handleDragOver);
        answerContainer.addEventListener('drop', handleDrop);
        
        // 为字母区域添加放置区域事件
        lettersContainer.addEventListener('dragover', handleDragOver);
        lettersContainer.addEventListener('drop', handleDrop);
    
        resetButtons();
        updateProgress();
        
        // 清除所有占位符和指示器
        document.querySelectorAll('.letter-space, .insert-indicator').forEach(space => {
            space.remove();
        });
        
        // 重置拖拽相关变量
        draggedElement = null;
        originalParent = null;
        originalNextSibling = null;
        placeholder = null;
    }
    
    // 拖拽相关函数
    let draggedElement = null;
    let originalParent = null;
    let originalNextSibling = null;
    let placeholder = null;
    
    function handleDragStart(e) {
        draggedElement = this;
        originalParent = this.parentNode;
        originalNextSibling = this.nextSibling;
        
        // 创建占位符，保持原位置
        if (originalParent === lettersContainer) {
            placeholder = document.createElement('div');
            placeholder.className = 'letter-space';
            originalParent.insertBefore(placeholder, originalNextSibling);
        }
        
        this.classList.add('dragging');
        e.dataTransfer.effectAllowed = 'move';
        e.dataTransfer.setData('text/plain', this.textContent);
        
        // 延迟设置拖拽图像，避免闪烁
        setTimeout(() => {
            this.style.opacity = '0.5';
        }, 0);
        
        startTimer(); // 开始计时
    }
    
    function handleDragEnd(e) {
        this.classList.remove('dragging');
        this.style.opacity = '1';
        
        // 如果拖拽未成功完成（没有放置到有效区域），恢复原位置
        if (draggedElement && !draggedElement.parentNode) {
            if (originalParent === lettersContainer && placeholder) {
                originalParent.replaceChild(draggedElement, placeholder);
            } else {
                originalParent.insertBefore(draggedElement, originalNextSibling);
            }
        }
        
        draggedElement = null;
        originalParent = null;
        originalNextSibling = null;
        
        // 移除所有占位符
        document.querySelectorAll('.letter-space').forEach(space => {
            if (space === placeholder) {
                space.remove();
            }
        });
        placeholder = null;
    }
    
    function handleDragOver(e) {
        e.preventDefault();
        e.dataTransfer.dropEffect = 'move';
        
        // 获取当前拖动经过的元素
        const target = e.target;
        
        // 如果拖动经过的是字母块，并且在答案区域内
        if (target.classList.contains('letter') && target.parentNode === answerContainer) {
            // 计算鼠标位置
            const rect = target.getBoundingClientRect();
            const mouseX = e.clientX;
            const middleX = rect.left + rect.width / 2;
            
            // 移除所有临时指示器
            document.querySelectorAll('.insert-indicator').forEach(el => el.remove());
            
            // 创建插入指示器
            const indicator = document.createElement('div');
            indicator.className = 'insert-indicator';
            
            // 根据鼠标位置决定插入指示器的位置
            if (mouseX < middleX) {
                // 鼠标在字母块左侧
                indicator.style.left = `${rect.left - 2}px`;
                indicator.style.top = `${rect.top}px`;
                target.dataset.insertPosition = 'before';
            } else {
                // 鼠标在字母块右侧
                indicator.style.left = `${rect.right}px`;
                indicator.style.top = `${rect.top}px`;
                target.dataset.insertPosition = 'after';
            }
            
            // 添加指示器到文档
            document.body.appendChild(indicator);
        }
        
        return false;
    }
    
    function handleDrop(e) {
        e.preventDefault();
        
        if (!draggedElement) return;
        
        // 移除所有插入指示器
        document.querySelectorAll('.insert-indicator').forEach(el => el.remove());
        
        const target = e.target;
        
        // 如果放置在答案区域的字母块上
        if (target.classList.contains('letter') && target.parentNode === answerContainer) {
            // 根据之前确定的插入位置插入字母块
            const insertPosition = target.dataset.insertPosition || 'after';
            
            if (insertPosition === 'before') {
                answerContainer.insertBefore(draggedElement, target);
            } else {
                answerContainer.insertBefore(draggedElement, target.nextSibling);
            }
            
            // 更新事件监听器
            draggedElement.removeEventListener('click', () => moveLetter(draggedElement));
            draggedElement.addEventListener('click', () => returnLetter(draggedElement, placeholder));
            
            // 清除插入位置标记
            target.removeAttribute('data-insert-position');
        }
        // 如果放置在答案区域（但不是字母块上）
        else if (this === answerContainer) {
            // 从字母区域拖到答案区域
            answerContainer.appendChild(draggedElement);
            draggedElement.removeEventListener('click', () => moveLetter(draggedElement));
            draggedElement.addEventListener('click', () => returnLetter(draggedElement, placeholder));
        } else if (this === lettersContainer && draggedElement.parentNode === answerContainer) {
            // 从答案区域拖回字母区域
            if (placeholder && placeholder.parentNode === lettersContainer) {
                // 使用替换方法而不是移除后添加，这样可以保持布局
                lettersContainer.replaceChild(draggedElement, placeholder);
                placeholder = null;
            } else {
                // 如果没有原始占位符，查找一个空的letter-space来替换
                const emptySpaces = Array.from(lettersContainer.querySelectorAll('.letter-space'));
                if (emptySpaces.length > 0) {
                    lettersContainer.replaceChild(draggedElement, emptySpaces[0]);
                } else {
                    // 如果没有空位，直接添加到字母容器末尾
                    lettersContainer.appendChild(draggedElement);
                }
            }
            
            draggedElement.removeEventListener('click', () => returnLetter(draggedElement, placeholder));
            draggedElement.addEventListener('click', () => moveLetter(draggedElement));
        }
        
        return false;
    }
    
    function moveLetter(letterButton) {
        // 创建占位符，保持原位置
        const placeholder = document.createElement('div');
        placeholder.className = 'letter-space';
        
        // 记录字母块的原始位置
        const originalIndex = Array.from(lettersContainer.children).indexOf(letterButton);
        
        // 插入占位符到字母块的位置
        lettersContainer.insertBefore(placeholder, letterButton);
        
        // 移动字母块到答案区域
        answerContainer.appendChild(letterButton);
        
        // 更新事件监听器
        letterButton.removeEventListener('click', () => moveLetter(letterButton));
        letterButton.addEventListener('click', () => returnLetter(letterButton, placeholder));
        
        startTimer(); // 开始计时
    }
    
    function returnLetter(letterButton, placeholder) {
        // 移除所有可能存在的临时指示器
        document.querySelectorAll('.insert-indicator').forEach(el => el.remove());
        
        // 如果有占位符，替换占位符；否则直接添加到字母容器
        if (placeholder && placeholder.parentNode === lettersContainer) {
            // 使用替换方法而不是移除后添加，这样可以保持布局
            lettersContainer.replaceChild(letterButton, placeholder);
        } else {
            // 如果没有占位符，查找一个空的letter-space来替换
            const emptySpaces = Array.from(lettersContainer.querySelectorAll('.letter-space'));
            if (emptySpaces.length > 0) {
                lettersContainer.replaceChild(letterButton, emptySpaces[0]);
            } else {
                // 如果没有空位，直接添加到字母容器末尾
                lettersContainer.appendChild(letterButton);
            }
        }
        
        // 重新绑定事件
        letterButton.removeEventListener('click', () => returnLetter(letterButton, placeholder));
        letterButton.addEventListener('click', () => moveLetter(letterButton));
    }
    
    function updateProgress() {
        const progressElement = document.getElementById('progress');
        const totalWords = units[currentUnit].length;
        progressElement.textContent = `${currentWordIndex + 1}/${totalWords}`;
    }
    
    function checkAnswer() {
        const userAnswer = Array.from(answerContainer.children)
            .filter(child => child.classList.contains('letter')) // 只考虑字母元素，排除可能的占位符
            .map(child => child.textContent)
            .join('');
            
        if (userAnswer === currentWord.word) {
            checkBtn.textContent = "正确";
            checkBtn.classList.add('correct');
            nextBtn.textContent = "下一个";
            nextBtn.classList.add('correct');
            nextBtn.classList.remove('incorrect');
            playAudio(currentWord.word);
            
            // 检查是否完成当前单元
            if (currentWordIndex === units[currentUnit].length - 1) {
                nextBtn.textContent = "恭喜完成"; // 修改按钮文本
                clearInterval(timerInterval); // 停止计时
            }
        } else {
            checkBtn.textContent = "错误";
            checkBtn.classList.add('incorrect');
            nextBtn.textContent = "请订正";
            nextBtn.classList.add('incorrect');
            nextBtn.classList.remove('correct');
            setTimeout(() => {
                checkBtn.textContent = "检查";
                checkBtn.classList.remove('incorrect');
            }, 2000);
        }
    }
    
    function nextWord() {
        if (checkBtn.textContent === "正确") {
            // 清除所有占位符和指示器
            document.querySelectorAll('.letter-space, .insert-indicator').forEach(space => {
                space.remove();
            });
            
            currentWordIndex = (currentWordIndex + 1) % units[currentUnit].length;
            displayWord();
            resetButtons();
            
            // 重置拖拽相关变量
            draggedElement = null;
            originalParent = null;
            originalNextSibling = null;
            placeholder = null;
        } else if (nextBtn.textContent === "恭喜完成") {
            // 不执行任何操作，直接返回
            return;
        }
    }
    
    function playAudio(word) {
        const audio = new Audio(`https://dict.youdao.com/dictvoice?audio=${word}&type=1`);
        audio.play().catch(error => console.error('Error playing audio:', error));
    }
    
    function changeUnit(unit) {
        resetTimer(); // 重置计时器
        
        // 清除所有占位符和指示器
        document.querySelectorAll('.letter-space, .insert-indicator').forEach(space => {
            space.remove();
        });
        
        currentUnit = unit;
        currentWordIndex = 0;
        displayWord();
        unitTabs.forEach(tab => tab.classList.remove('active'));
        document.querySelector(`.unit-tab[data-unit="${unit}"]`).classList.add('active');
        
        // 重置拖拽相关变量
        draggedElement = null;
        originalParent = null;
        originalNextSibling = null;
        placeholder = null;
        // 不再在这里调用 startTimer()
    }
    
    function resetButtons() {
        checkBtn.textContent = "检查";
        checkBtn.classList.remove('correct', 'incorrect');
        nextBtn.textContent = "下一个";
        nextBtn.classList.remove('correct', 'incorrect');
    }
    
    function resetTimer() {
        clearInterval(timerInterval); // 停止计时
        seconds = 0; // 重置计时器
        document.getElementById('timer').textContent = "00:00"; // 显示为零
        timerInterval = null; // 清空计时器变量
    }
    
    checkBtn.addEventListener('click', checkAnswer);
    nextBtn.addEventListener('click', () => {
        if (nextBtn.textContent === "恭喜完成") {
            // 不执行任何操作，直接返回
            return;
        }
        nextWord(); // 仅在不是"恭喜完成"时调用 nextWord
    });
    
    unitTabs.forEach(tab => {
        tab.addEventListener('click', () => changeUnit(parseInt(tab.dataset.unit)));
    });
    
    displayWord();
    
    let timerInterval;
    let seconds = 0;
    
    document.getElementById('homeBtn').addEventListener('click', () => {
        window.location.href = './index.html'; // 使用相对路径返回主页
    });
    
    function startTimer() {
        if (!timerInterval) {
            timerInterval = setInterval(() => {
                seconds++;
                const minutes = String(Math.floor(seconds / 60)).padStart(2, '0');
                const secs = String(seconds % 60).padStart(2, '0');
                document.getElementById('timer').textContent = `${minutes}:${secs}`;
            }, 1000);
        }
    }
    </script>
    </body>
    </html>