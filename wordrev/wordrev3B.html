<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>阅读类单词快训</title>
    <style>
        body {
            font-family: 'Comic Sans MS', cursive;
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: flex-start; /* 改为顶部对齐而非居中 */
            min-height: 100vh;
            margin: 0;
            padding-top: 40px; /* 添加顶部间距 */
            background-color: #E3EDCD; /* 更改为护眼绿色 */
        }
        .word-container {
            font-size: 48px;
            margin: 30px 0;
            height: 80px; /* 固定高度 */
            display: flex;
            align-items: center;
            justify-content: center;
        }
        .word-jump {
            animation: bounce 0.5s ease-out; /* 添加一个较短的一次性动画类 */
        }
        .word-wrong {
            color: red;
            font-weight: bold;
            font-size: 60px;
            animation: bounce 0.5s ease-out;
        }
        .word-normal {
            color: black;
            font-weight: normal;
            font-size: 48px;
            transition: all 0.3s ease;
        }
        .options-container {
            display: flex;
            gap: 20px;
        }
        .option-button {
            font-size: 24px;
            padding: 15px 30px;
            border: none;
            border-radius: 15px;
            background-color: #ffd1dc;
            cursor: pointer;
            transition: transform 0.2s;
        }
        .option-button:hover {
            transform: scale(1.1);
            background-color: #ffb6c1;
        }
        @keyframes bounce {
            0%, 100% { transform: translateY(0); }
            50% { transform: translateY(-20px); }
        }
        .score-container {
            display: flex;
            gap: 20px;
            font-size: 24px;
            margin-top: 20px;
        }
        .unit-buttons {
            margin-bottom: 30px;
            display: flex;
            flex-wrap: wrap; /* 允许按钮换行 */
            justify-content: center;
            gap: 10px; /* 按钮之间的间距，同时提供横向和纵向间距 */
            max-width: 90%;
        }
        .unit-button {
            font-size: 18px;
            padding: 10px 20px;
            border: none;
            border-radius: 10px;
            background-color: #ddd;
            cursor: pointer;
            transition: all 0.3s;
            margin: 0; /* 移除原有的margin，使用gap来控制间距 */
        }
        .unit-button.active {
            background-color: #97c1a9;
            color: white;
        }
        .grade-title {
            font-size: 28px;
            font-weight: bold;
            margin-bottom: 25px; /* 增加底部间距 */
            color: #2c6e49;
            text-align: center;
        }
        .main-content {
            display: flex;
            flex-direction: column;
            align-items: center;
            width: 100%;
        }
        .header-section {
            margin-bottom: 20px;
            width: 100%;
            text-align: center;
        }
        .word-section {
            width: 100%;
            margin-bottom: 30px;
        }
        .options-section {
            width: 100%;
            display: flex;
            flex-direction: column;
            align-items: center;
            margin-bottom: 20px;
        }
    </style>
</head>
<body>
    <div class="header-section">
        <div class="grade-title">三年下阅读类词汇训练</div>
        <div class="unit-buttons">
            <button class="unit-button" data-unit="1">Unit 1</button>
            <button class="unit-button" data-unit="2">Unit 2</button>
            <button class="unit-button" data-unit="3">Unit 3</button>
            <button class="unit-button" data-unit="4">Unit 4</button>
            <button class="unit-button" data-unit="5">Unit 5</button>
            <button class="unit-button" data-unit="6">Unit 6</button>
        </div>
    </div>
    
    <div class="word-section">
        <div class="word-container" id="word">Loading...</div>
    </div>
    
    <div class="options-section">
        <div class="options-container">
            <button class="option-button" id="optionA">选项A</button>
            <button class="option-button" id="optionB">选项B</button>
        </div>
        <div class="score-container">
            <div id="score">得分: 0</div>
            <div id="wordCount">进度: 0/0</div>
        </div>
    </div>

    <script>
        const wordsByUnit = {
            1: {
                'where': '哪里', 'from': '从', 'about': '关于', 'today': '今天',
                'teacher': '老师', 'student': '学生', 'after': '之后', 'who': '谁',
                'girl': '女孩', 'neighbour': '邻居', 'boy': '男孩', 'woman': '女人',
                'man': '男人', 'Mr.': '先生', 'classmate': '同学', 'he': '他',
                'English': '英语', 'she': '她', 'very': '非常', 'UK': '英国',
                'China': '中国', 'Canada': '加拿大', 'USA': '美国'
            },
            2: {
                'has': '有', 'long': '长的', 'body': '身体', 'short': '短的',
                'leg': '腿', 'right': '对的', 'fat': '胖的', 'thin': '瘦的',
                'slow': '慢的', 'love': '爱', 'tail': '尾巴', 'bye': '再见',
                'her': '她的', 'gift': '礼物', 'picture': '图片', 'card': '卡片',
                'sing': '唱歌', 'dance': '跳舞', 'all': '所有的', 'so': '如此',
                'talk': '说话', 'song': '歌曲', 'or': '或者', 'much': '许多'
            }
        };

        let activeUnits = new Set();
        let words = {};
        let completedWords = new Set(); // 新增：跟踪已完成的单词
        let score = 0;
        let currentWord = '';
        let correctAnswer = '';
        let answeredWrong = false;

        function updateActiveWords() {
            words = {};
            completedWords.clear(); // 切换单元时重置已完成单词
            activeUnits.forEach(unit => {
                if (wordsByUnit[unit]) {
                    Object.assign(words, wordsByUnit[unit]);
                }
            });
            const totalWords = Object.keys(words).length;
            updateProgress(0, totalWords);
            
            if (totalWords === 0) {
                document.getElementById('word').textContent = '请选择训练单元';
                return false;
            }
            return true;
        }

        function updateProgress(completed, total) {
            document.getElementById('wordCount').textContent = 
                `进度: ${completed}/${total}`;
        }

        function getRandomWord() {
            const availableWords = Object.keys(words).filter(word => 
                !completedWords.has(word));
            
            if (availableWords.length === 0) {
                alert('恭喜！您已完成所有单词的训练！');
                completedWords.clear(); // 重置已完成单词，允许重新开始
                return Object.keys(words)[0];
            }
            
            return availableWords[Math.floor(Math.random() * availableWords.length)];
        }

        function getRandomMeaning(excludeMeaning) {
            const meaningsList = Object.values(words);
            let randomMeaning;
            do {
                randomMeaning = meaningsList[Math.floor(Math.random() * meaningsList.length)];
            } while (randomMeaning === excludeMeaning); // 确保不会选到要排除的意思
            return randomMeaning;
        }

        function newQuestion() {
            if (Object.keys(words).length === 0) {
                return;
            }
            currentWord = getRandomWord();
            correctAnswer = words[currentWord];
            answeredWrong = false; // 重置答错标记
            
            const wordElement = document.getElementById('word');
            wordElement.classList.remove('word-jump');
            void wordElement.offsetWidth; // 触发重排
            wordElement.classList.add('word-jump');
            wordElement.textContent = currentWord;

            const isCorrectFirst = Math.random() < 0.5;
            const wrongAnswer = getRandomMeaning(correctAnswer); // 传入正确答案作为排除项

            document.getElementById('optionA').textContent = isCorrectFirst ? correctAnswer : wrongAnswer;
            document.getElementById('optionB').textContent = isCorrectFirst ? wrongAnswer : correctAnswer;
        }

        function checkAnswer(selectedAnswer) {
            const wordElement = document.getElementById('word');
            
            if (selectedAnswer === correctAnswer) {
                if (!answeredWrong) {
                    score += 10;
                    document.getElementById('score').textContent = `得分: ${score}`;
                }
                completedWords.add(currentWord); // 添加到已完成集合
                updateProgress(completedWords.size, Object.keys(words).length);
                newQuestion();
            } else {
                answeredWrong = true; // 标记已答错
                wordElement.classList.remove('word-normal');
                wordElement.classList.add('word-wrong');
                
                setTimeout(() => {
                    wordElement.classList.remove('word-wrong');
                    wordElement.classList.add('word-normal');
                }, 1000);
            }
        }
        
        // 初始化单元按钮事件监听
        document.querySelectorAll('.unit-button').forEach(button => {
            button.addEventListener('click', () => {
                const unit = parseInt(button.dataset.unit);
                if (!wordsByUnit[unit]) {
                    alert('该单元暂时没有单词');
                    return;
                }
                
                button.classList.toggle('active');
                if (activeUnits.has(unit)) {
                    activeUnits.delete(unit);
                } else {
                    activeUnits.add(unit);
                }
                
                if (updateActiveWords()) {
                    newQuestion();
                }
            });
        });

        // 初始化选项按钮事件监听
        document.getElementById('optionA').onclick = function() {
            checkAnswer(this.textContent);
        };

        document.getElementById('optionB').onclick = function() {
            checkAnswer(this.textContent);
        };

        // 初始化状态
        document.getElementById('word').classList.add('word-normal');
        document.querySelector('[data-unit="1"]').click();

        // 开始第一个问题
        newQuestion();
    </script>
</body>
</html>
